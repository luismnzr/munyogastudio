<nav class="navbar">
  <%= link_to 'Clases', payments_new_path, class: 'button-white' %>
  <%= link_to root_path do %>
    <%= image_tag("mun_logo.svg") %>
  <% end %>
  <% if current_user %>
    <%= link_to "Mis Reservas", reservations_path, class: 'button-white' %>
    <%= link_to "Mi Cuenta", edit_user_registration_path, class: 'button-orange'  %>
  <% else %>
    <%= link_to 'Iniciar sesión', new_user_session_path, class: 'button-green' %>
  <% end %>
</nav>
<div class="calendarioCover">
    <h2>Nuestro calendario semanal</h2>
    <% if current_user %>
      <p style="color: white; margin-top: 10px;">Tus clases disponibles: <%= current_user.yogaclass %></p>
    <% end %>

    <div style="display: flex; align-items: center; justify-content: center; gap: 20px; margin-top: 20px;">
      <%= link_to '← Semana Anterior', calendario_path(week: @current_week_offset - 1), class: 'button-white', style: 'display: inline-block; padding: 10px 20px; font-size: 14px;' %>
      <p style="color: white; margin: 0;">
        <%= @start_of_week.strftime('%d %b') %> - <%= @end_of_week.strftime('%d %b %Y') %>
      </p>
      <%= link_to 'Semana Siguiente →', calendario_path(week: @current_week_offset + 1), class: 'button-white', style: 'display: inline-block; padding: 10px 20px; font-size: 14px;' %>
    </div>

    <% if @current_week_offset != 0 %>
      <%= link_to 'Volver a semana actual', calendario_path, style: 'color: white; font-size: 14px; margin-top: 10px; display: inline-block; text-decoration: underline;' %>
    <% end %>
</div>
<div class="calendarGrid">
    <% 7.times do |i| %>
      <% date = @start_of_week + i.days %>
      <% day_sessions = @sessions_by_date[date] || [] %>
      <% is_today = date == Date.today %>

      <div class="calendarGrid-column">
        <h3 style="<%= 'color: #ee7756;' if is_today %>"><%= date.strftime('%A') %></h3>
        <p style="font-size: 14px; color: <%= is_today ? '#ee7756' : '#666' %>; font-weight: <%= is_today ? 'bold' : 'normal' %>;">
          <%= date.strftime('%d/%m') %>
          <%= '(Hoy)' if is_today %>
        </p>

        <% if day_sessions.any? %>
          <% day_sessions.each do |session| %>
            <div class="calendarGrid-item" style="<%= 'opacity: 0.6;' if session.full? %>">
              <p><%= session.start_time.strftime('%I:%M %p') %></p>
              <p class="calendarGrid-class"><%= session.class_type %></p>
              <% if session.instructor_name.present? %>
                <p style="font-size: 14px;"><%= session.instructor_name %></p>
              <% end %>

              <p style="font-size: 12px; margin: 10px 0; color: <%= session.available_spots > 0 ? '#28a745' : '#dc3545' %>;">
                <%= session.available_spots %> / <%= session.capacity %> espacios
              </p>

              <% if current_user %>
                <% user_reservation = current_user.reservations.confirmed.find_by(class_session_id: session.id) %>
                <% if user_reservation %>
                  <p style="background: #28a745; color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px;">✓ Reservada</p>
                <% elsif session.full? %>
                  <p style="background: #dc3545; color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px;">Lleno</p>
                <% elsif current_user.yogaclass > 0 %>
                  <%= button_to 'Reservar', reservations_path(class_session_id: session.id), method: :post, style: 'background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; width: 100%; margin-top: 5px;' %>
                <% else %>
                  <p style="background: #ffc107; color: #000; padding: 5px 10px; border-radius: 15px; font-size: 12px;">Sin clases</p>
                <% end %>
              <% else %>
                <%= link_to 'Iniciar sesión', new_user_session_path, style: 'color: #007bff; font-size: 12px;' %>
              <% end %>
            </div>
          <% end %>
        <% else %>
          <p style="color: #999; font-style: italic; padding: 20px 10px;">Sin clases</p>
        <% end %>
      </div>
    <% end %>
</div>
