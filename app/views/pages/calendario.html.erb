<nav class="navbar">
  <%= link_to 'Clases', payments_new_path, class: 'button-white' %>
  <%= link_to root_path do %>
    <%= image_tag("mun_logo.svg") %>
  <% end %>
  <% if current_user %>
    <%= link_to "Mis Reservas", reservations_path, class: 'button-white' %>
    <%= link_to "Mi Cuenta", edit_user_registration_path, class: 'button-orange'  %>
  <% else %>
    <%= link_to 'Iniciar sesión', new_user_session_path, class: 'button-green' %>
  <% end %>
</nav>
<div class="calendarioCover">
    <h2>Nuestro calendario semanal</h2>
    <% if current_user %>
      <p style="color: white; margin-top: 10px;">Tus clases disponibles: <%= current_user.yogaclass %></p>
    <% end %>
</div>
<div class="calendarGrid">
    <% 7.times do |i| %>
      <% date = Date.today + i.days %>
      <% day_sessions = @sessions_by_date[date] || [] %>

      <div class="calendarGrid-column">
        <h3><%= date.strftime('%A') %></h3>
        <p style="font-size: 14px; color: #666;"><%= date.strftime('%d/%m') %></p>

        <% if day_sessions.any? %>
          <% day_sessions.each do |session| %>
            <div class="calendarGrid-item" style="<%= 'opacity: 0.6;' if session.full? %>">
              <p><%= session.start_time.strftime('%I:%M %p') %></p>
              <p class="calendarGrid-class"><%= session.class_type %></p>
              <% if session.instructor_name.present? %>
                <p style="font-size: 14px;"><%= session.instructor_name %></p>
              <% end %>

              <p style="font-size: 12px; margin: 10px 0; color: <%= session.available_spots > 0 ? '#28a745' : '#dc3545' %>;">
                <%= session.available_spots %> / <%= session.capacity %> espacios
              </p>

              <% if current_user %>
                <% user_reservation = current_user.reservations.confirmed.find_by(class_session_id: session.id) %>
                <% if user_reservation %>
                  <p style="background: #28a745; color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px;">✓ Reservada</p>
                <% elsif session.full? %>
                  <p style="background: #dc3545; color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px;">Lleno</p>
                <% elsif current_user.yogaclass > 0 %>
                  <%= button_to 'Reservar', reservations_path(class_session_id: session.id), method: :post, style: 'background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; width: 100%; margin-top: 5px;' %>
                <% else %>
                  <p style="background: #ffc107; color: #000; padding: 5px 10px; border-radius: 15px; font-size: 12px;">Sin clases</p>
                <% end %>
              <% else %>
                <%= link_to 'Iniciar sesión', new_user_session_path, style: 'color: #007bff; font-size: 12px;' %>
              <% end %>
            </div>
          <% end %>
        <% else %>
          <p style="color: #999; font-style: italic; padding: 20px 10px;">Sin clases</p>
        <% end %>
      </div>
    <% end %>
</div>
