<nav class="navbar-home">
  <div class="navbar-home-container">
    <div class="navbar-home-left"></div>
    <div class="navbar-home-center" id="navbarLogoTarget"></div>
    <div class="navbar-home-right">
      <button class="navbar-home-toggle" id="navbarHomeToggle">
        <span></span>
        <span></span>
        <span></span>
      </button>

      <div class="navbar-home-menu" id="navbarHomeMenu">
        <%= link_to 'Planes', payments_new_path, class: 'button-white' %>
        <% if current_user %>
          <%= link_to "Reserva clase", calendario_path, class: 'button-white' %>
          <%= link_to "Mi Cuenta", edit_user_registration_path, class: 'button-orange' %>
        <% else %>
          <%= link_to 'Iniciar sesión', new_user_session_path, class: 'button-green' %>
        <% end %>
      </div>
    </div>
  </div>
</nav>

<div class="home_hero">
    <%= image_tag("mun_logo.svg", id: "heroLogo") %>
</div>

<style>
  .navbar-home {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    padding: 20px 0;
    z-index: 100;
    transition: background-color 0.3s ease, position 0.1s ease;
  }

  .navbar-home.scrolled {
    position: fixed;
    background-color: #f6ddda;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  }

  .navbar-home-container {
    width: 100%;
    max-width: 1320px;
    margin: 0 auto;
    padding: 0 2rem;
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    height: 80px;
  }

  .navbar-home-left {
    /* Empty space for balance */
  }

  .navbar-home-center {
    display: flex;
    justify-content: center;
    align-items: center;
    /* This will be the target for the animated logo */
  }

  .navbar-home-right {
    display: flex;
    align-items: center;
    gap: 15px;
    justify-content: flex-end;
  }

  .navbar-home-toggle {
    display: none;
    flex-direction: column;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
    z-index: 101;
  }

  .navbar-home-toggle span {
    width: 25px;
    height: 3px;
    background: #253938;
    margin: 3px 0;
    transition: all 0.3s ease;
    border-radius: 3px;
  }

  .navbar-home.scrolled .navbar-home-toggle span {
    background: #253938;
  }

  .navbar-home-toggle.active span:nth-child(1) {
    transform: rotate(45deg) translate(7px, 7px);
  }

  .navbar-home-toggle.active span:nth-child(2) {
    opacity: 0;
  }

  .navbar-home-toggle.active span:nth-child(3) {
    transform: rotate(-45deg) translate(7px, -7px);
  }

  .navbar-home-menu {
    display: flex;
    align-items: center;
    gap: 15px;
  }

  .navbar-home-menu .button-white,
  .navbar-home-menu .button-green,
  .navbar-home-menu .button-orange {
    padding: 0.75rem 1.5rem;
    width: auto;
    white-space: nowrap;
  }

  #heroLogo {
    position: fixed;
    z-index: 101;
    transition: none;
    will-change: transform, width;
  }

  @media screen and (max-width: 749px) {
    .navbar-home-container {
      padding: 0 1rem;
      grid-template-columns: auto 1fr;
      justify-items: flex-end;
    }

    .navbar-home-left {
      display: none;
    }

    .navbar-home-center {
      grid-column: 1;
      justify-self: start;
    }

    .navbar-home-right {
      grid-column: 2;
      justify-self: end;
    }

    .navbar-home-toggle {
      display: flex;
    }

    .navbar-home-menu {
      position: fixed;
      top: 80px;
      right: -100%;
      width: 250px;
      height: calc(100vh - 80px);
      background: #f6ddda;
      flex-direction: column;
      align-items: stretch;
      gap: 0;
      padding: 20px;
      box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
      transition: right 0.3s ease;
    }

    .navbar-home-menu.active {
      right: 0;
    }

    .navbar-home-menu .button-white,
    .navbar-home-menu .button-green,
    .navbar-home-menu .button-orange {
      width: 100%;
      text-align: center;
      margin-bottom: 10px;
      display: block;
      padding: 0.75rem 1.5rem;
    }

    #heroLogo {
      /* Keep logo visible and smaller on mobile */
      position: fixed !important;
      z-index: 102 !important;
    }

    .navbar-home.scrolled {
      background-color: #f6ddda;
    }
  }
</style>

<script>
  (function() {
    let animationInitialized = false;
    let hamburgerInitialized = false;

    // Initialize hamburger menu
    function initHamburgerMenu() {
      if (hamburgerInitialized) return;

      const toggle = document.getElementById('navbarHomeToggle');
      const menu = document.getElementById('navbarHomeMenu');

      if (toggle && menu) {
        hamburgerInitialized = true;

        toggle.addEventListener('click', function(event) {
          event.preventDefault();
          event.stopPropagation();
          menu.classList.toggle('active');
          toggle.classList.toggle('active');
        });

        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
          if (!toggle.contains(event.target) && !menu.contains(event.target)) {
            menu.classList.remove('active');
            toggle.classList.remove('active');
          }
        });

        // Close menu when clicking a link inside
        menu.querySelectorAll('a').forEach(function(link) {
          link.addEventListener('click', function() {
            menu.classList.remove('active');
            toggle.classList.remove('active');
          });
        });
      }
    }

    // Initialize logo animation
    function initLogoAnimation() {
      if (animationInitialized) return;

      const logo = document.getElementById('heroLogo');
      const navbar = document.querySelector('.navbar-home');
      const navbarTarget = document.getElementById('navbarLogoTarget');
      const hero = document.querySelector('.home_hero');

      if (!logo || !navbar || !navbarTarget || !hero) return;

      // On mobile, use simpler animation
      if (window.innerWidth <= 749) {
        animationInitialized = true;

        // Get initial measurements for mobile
        const heroRect = hero.getBoundingClientRect();
        const initialLogoWidth = logo.offsetWidth;
        const finalLogoWidth = 120; // Same as desktop

        const initialTop = heroRect.top + window.scrollY + (heroRect.height / 2) - (logo.offsetHeight / 2);
        const initialLeft = heroRect.left + (heroRect.width / 2) - (logo.offsetWidth / 2);

        // Final position on mobile (left side of navbar, 20px lower)
        const finalTop = 20;
        const finalLeft = 10;

        logo.style.top = (initialTop - window.scrollY) + 'px';
        logo.style.left = initialLeft + 'px';
        logo.style.width = initialLogoWidth + 'px';

        const scrollDistance = 300;

        function handleScrollMobile() {
          const scrollY = window.scrollY;
          const progress = Math.min(scrollY / scrollDistance, 1);

          const currentTop = (initialTop - scrollY) + ((finalTop - (initialTop - scrollY)) * progress);
          const currentLeft = initialLeft + (finalLeft - initialLeft) * progress;
          const currentWidth = initialLogoWidth + (finalLogoWidth - initialLogoWidth) * progress;

          logo.style.top = currentTop + 'px';
          logo.style.left = currentLeft + 'px';
          logo.style.width = currentWidth + 'px';

          if (progress >= 0.8) {
            navbar.classList.add('scrolled');
          } else {
            navbar.classList.remove('scrolled');
          }
        }

        let ticking = false;
        window.addEventListener('scroll', function() {
          if (!ticking) {
            window.requestAnimationFrame(function() {
              handleScrollMobile();
              ticking = false;
            });
            ticking = true;
          }
        });

        handleScrollMobile();
        return;
      }

      animationInitialized = true;

      // Get initial measurements for desktop
      const heroRect = hero.getBoundingClientRect();
      const navbarTargetRect = navbarTarget.getBoundingClientRect();
      const initialLogoWidth = logo.offsetWidth;
      const finalLogoWidth = 120;

      // Calculate initial position (center of hero) in page coordinates
      const initialTop = heroRect.top + window.scrollY + (heroRect.height / 2) - (logo.offsetHeight / 2);
      const initialLeft = heroRect.left + (heroRect.width / 2) - (logo.offsetWidth / 2);

      // Calculate final position (navbar center when fixed at top) in viewport coordinates
      const navbarHeight = 80;
      const finalTop = 0 + (navbarHeight / 2) - (finalLogoWidth / 2 * (logo.offsetHeight / logo.offsetWidth));
      const finalLeft = navbarTargetRect.left + (navbarTargetRect.width / 2) - (finalLogoWidth / 2);

      // Set initial fixed position
      logo.style.top = (initialTop - window.scrollY) + 'px';
      logo.style.left = initialLeft + 'px';
      logo.style.width = initialLogoWidth + 'px';

      // Scroll distance for complete animation
      const scrollDistance = 400;

      function handleScroll() {
        const scrollY = window.scrollY;
        const progress = Math.min(scrollY / scrollDistance, 1);

        // Calculate current position
        const currentTop = (initialTop - scrollY) + ((finalTop - (initialTop - scrollY)) * progress);
        const currentLeft = initialLeft + (finalLeft - initialLeft) * progress;
        const currentWidth = initialLogoWidth + (finalLogoWidth - initialLogoWidth) * progress;

        // Apply styles
        logo.style.top = currentTop + 'px';
        logo.style.left = currentLeft + 'px';
        logo.style.width = currentWidth + 'px';

        // Toggle navbar scrolled state
        if (progress >= 0.8) {
          navbar.classList.add('scrolled');
        } else {
          navbar.classList.remove('scrolled');
        }
      }

      // Throttle scroll event for performance
      let ticking = false;
      window.addEventListener('scroll', function() {
        if (!ticking) {
          window.requestAnimationFrame(function() {
            handleScroll();
            ticking = false;
          });
          ticking = true;
        }
      });

      // Initial call
      handleScroll();

      // Recalculate on resize
      let resizeTimeout;
      window.addEventListener('resize', function() {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(function() {
          if (window.innerWidth > 749) {
            location.reload();
          }
        }, 250);
      });
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {
        initHamburgerMenu();
        initLogoAnimation();
      });
    } else {
      initHamburgerMenu();
      initLogoAnimation();
    }
  })();
</script>

<div class="container">
    <div class="home_textBanner">
        <%= image_tag("om.svg") %>
        <h2>¡Bienvenidx a Mun!</h2>
        <br>
        <p>
            Mun Yoga Studio nació con la intención de ser un refugio seguro en medio del caos cotidiano de la ciudad. Nuestro objetivo es ayudarte a encontrar equilibrio físico, mental y espiritual a través de la práctica de yoga en todas sus formas. Ofrecemos clases para todos los niveles en un entorno diseñado para apoyarte en tu crecimiento, sanación y conexión con una comunidad que comparte tu camino.
            <br><br>
            Bienvenidx a Mun Yoga Studio, tu refugio en la ciudad.
        </p>
        <br>
        <%= link_to "Consulta horarios", calendario_path, class: 'button-green' %>
    </div>
</div>

<div class="containerColumns">
    <div class="home_stylesColumn">
         <h2>Nuestras clases </h2>
         <br>
         <p>
            En Mun Yoga Studio, ofrecemos una variedad de clases diseñadas para adaptarse a todos los niveles de experiencia, desde principiantes hasta practicantes avanzados. Cada clase está cuidadosamente estructurada para ayudarte a encontrar equilibrio y bienestar en cuerpo, mente y espíritu.
         </p>
    </div>
    <div class="home_stylesColumn">
        <%= image_tag("gradient_moon.png") %>
    </div>
</div>

<div class="container anasana_cover">
    <%= image_tag("anasana.jpg") %>
</div>

<div class="containerPrices">
    <div class="container">
        <h2>Planes y precios </h2>
        <br>
        <p>No necesitas hacer reservación previa para nuestras clases. Solo llega con tiempo, elige tu espacio y disfruta de tu práctica. Recuerda que tu plan tiene una vigencia de 30 días a partir de la fecha de pago.</p>
        <br>
        <%= link_to "Comprar clases", payments_new_path, class: 'button-orange button-orange-width' %>
    </div>

    <div class="container containerPrices-grid">
        <div class="containerPrices-item">
            <h2>1 Clase</h2>
            <br>
            <p>$250</p>
        </div>
        <div class="containerPrices-item">
            <h2>4 Clases</h2>
            <br>
            <p>$1,100</p>

        </div>
        <div class="containerPrices-item">
            <h2>8 Clases</h2>
            <br>
            <p>$1,500</p>

        </div>
        <div class="containerPrices-item">
            <h2>12 Clases</h2>
            <br>
            <p>$1,950</p>

        </div>
    </div>
    <%= image_tag("lotus.svg") %>
</div>

<div class="container containerLocation">
    <div class="containerLocation-map">
        <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d527.5190177242398!2d-100.25512774462042!3d25.582484537762166!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8662c7c7c0e50f29%3A0x6d0e70e9dfd561ba!2sMun%20Yoga%20Studio!5e0!3m2!1sen!2sus!4v1726679224542!5m2!1sen!2sus" width="600" height="450" style="border:0;border-radius:30px;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
    </div>
    <div class="containerLocation-about">
        <h2>
            Visita<br>
            Mun Yoga Studio
        </h2>
        <br>
        <p>Plaza Nacional #5500, Local 37<br>La Estanzuela, 64988 Monterrey, N.L., Mexico</p>
        <br>
        <p>Whatsapp: +52 1 81 2004 1759</p>
        <br>
        <p>
            Horarios: <br>
            Lunes a Viernes 6 am - 10:30 am, 6 pm - 8: 50 pm<br>
            Sábado<br>
            10 am- 11:30 
        </p>
        <a href="https://www.instagram.com/munyogastudio/" target="_blank">@munyogastudio</a>
    </div>
</div>