<nav class="navbar-home">
  <div class="navbar-home-container">
    <div class="navbar-home-left"></div>
    <div class="navbar-home-center" id="navbarLogoTarget"></div>
    <div class="navbar-home-right">
      <%= link_to 'Clases', payments_new_path, class: 'button-white' %>
      <% if current_user %>
        <%= link_to "Calendario", calendario_path, class: 'button-white' %>
        <%= link_to "Mi Cuenta", edit_user_registration_path, class: 'button-orange' %>
      <% else %>
        <%= link_to 'Iniciar sesión', new_user_session_path, class: 'button-green' %>
      <% end %>
    </div>
  </div>
</nav>

<div class="home_hero">
    <%= image_tag("mun_logo.svg", id: "heroLogo") %>
</div>

<style>
  .navbar-home {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    padding: 20px 0;
    z-index: 100;
    transition: background-color 0.3s ease, position 0.1s ease;
  }

  .navbar-home.scrolled {
    position: fixed;
    background-color: #f6ddda;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  }

  .navbar-home-container {
    max-width: 1320px;
    margin: 0 auto;
    padding: 0 2rem;
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
  }

  .navbar-home-left {
    /* Empty space for balance */
  }

  .navbar-home-center {
    display: flex;
    justify-content: center;
    align-items: center;
    /* This will be the target for the animated logo */
  }

  .navbar-home-right {
    display: flex;
    align-items: center;
    gap: 15px;
    justify-content: flex-end;
  }

  .navbar-home-right .button-white,
  .navbar-home-right .button-green,
  .navbar-home-right .button-orange {
    padding: 0.75rem 1.5rem;
    width: auto;
    white-space: nowrap;
  }

  #heroLogo {
    position: fixed;
    z-index: 101;
    transition: none;
    will-change: transform, width;
  }

  @media screen and (max-width: 749px) {
    .navbar-home-container {
      padding: 0 1rem;
      grid-template-columns: 1fr;
      justify-items: flex-end;
    }

    .navbar-home-left,
    .navbar-home-center {
      display: none;
    }

    .navbar-home-right {
      flex-direction: column;
      align-items: flex-end;
      gap: 10px;
    }

    .navbar-home-right .button-white,
    .navbar-home-right .button-green,
    .navbar-home-right .button-orange {
      padding: 0.5rem 1rem;
      font-size: 14px;
    }

    #heroLogo {
      /* Disable animation on mobile */
      position: static !important;
      transform: none !important;
      width: auto !important;
    }

    .navbar-home.scrolled {
      background-color: #f6ddda;
    }
  }
</style>

<script>
  (function() {
    let animationInitialized = false;

    function initLogoAnimation() {
      if (animationInitialized) return;

      const logo = document.getElementById('heroLogo');
      const navbar = document.querySelector('.navbar-home');
      const navbarTarget = document.getElementById('navbarLogoTarget');
      const hero = document.querySelector('.home_hero');

      if (!logo || !navbar || !navbarTarget || !hero) return;

      // Skip animation on mobile
      if (window.innerWidth <= 749) return;

      animationInitialized = true;

      // Get initial measurements
      const heroRect = hero.getBoundingClientRect();
      const navbarTargetRect = navbarTarget.getBoundingClientRect();
      const initialLogoWidth = logo.offsetWidth;
      const finalLogoWidth = 120;

      // Calculate initial position (center of hero) in page coordinates
      const initialTop = heroRect.top + window.scrollY + (heroRect.height / 2) - (logo.offsetHeight / 2);
      const initialLeft = heroRect.left + (heroRect.width / 2) - (logo.offsetWidth / 2);

      // Calculate final position (navbar center when fixed at top) in viewport coordinates
      // When navbar is fixed, it will be at top: 0, so we calculate based on that
      const navbarHeight = 80; // navbar height with padding
      const finalTop = 20 + (navbarHeight / 2) - (finalLogoWidth / 2 * (logo.offsetHeight / logo.offsetWidth));
      const finalLeft = navbarTargetRect.left + (navbarTargetRect.width / 2) - (finalLogoWidth / 2);

      // Set initial fixed position
      logo.style.top = (initialTop - window.scrollY) + 'px';
      logo.style.left = initialLeft + 'px';
      logo.style.width = initialLogoWidth + 'px';

      // Scroll distance for complete animation
      const scrollDistance = 400;

      function handleScroll() {
        const scrollY = window.scrollY;
        const progress = Math.min(scrollY / scrollDistance, 1);

        // Calculate current position
        // For top: interpolate from initial (page coords - scroll) to final (fixed viewport coords)
        const currentTop = (initialTop - scrollY) + ((finalTop - (initialTop - scrollY)) * progress);
        const currentLeft = initialLeft + (finalLeft - initialLeft) * progress;
        const currentWidth = initialLogoWidth + (finalLogoWidth - initialLogoWidth) * progress;

        // Apply styles
        logo.style.top = currentTop + 'px';
        logo.style.left = currentLeft + 'px';
        logo.style.width = currentWidth + 'px';

        // Toggle navbar scrolled state
        if (progress >= 0.8) {
          navbar.classList.add('scrolled');
        } else {
          navbar.classList.remove('scrolled');
        }
      }

      // Throttle scroll event for performance
      let ticking = false;
      window.addEventListener('scroll', function() {
        if (!ticking) {
          window.requestAnimationFrame(function() {
            handleScroll();
            ticking = false;
          });
          ticking = true;
        }
      });

      // Initial call
      handleScroll();

      // Recalculate on resize
      let resizeTimeout;
      window.addEventListener('resize', function() {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(function() {
          if (window.innerWidth > 749) {
            location.reload(); // Simple solution: reload on resize to recalculate everything
          }
        }, 250);
      });
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initLogoAnimation);
    } else {
      initLogoAnimation();
    }
  })();
</script>

<div class="container">
    <div class="home_textBanner">
        <%= image_tag("om.svg") %>
        <h2>¡Bienvenidx a Mun!</h2>
        <br>
        <p>
            Mun Yoga Studio nació con la intención de ser un refugio seguro en medio del caos cotidiano de la ciudad. Nuestro objetivo es ayudarte a encontrar equilibrio físico, mental y espiritual a través de la práctica de yoga en todas sus formas. Ofrecemos clases para todos los niveles en un entorno diseñado para apoyarte en tu crecimiento, sanación y conexión con una comunidad que comparte tu camino.
            <br><br>
            Bienvenidx a Mun Yoga Studio, tu refugio en la ciudad.
        </p>
        <br>
        <%= link_to "Consulta horarios", calendario_path, class: 'button-green' %>
    </div>
</div>

<div class="containerColumns">
    <div class="home_stylesColumn">
         <h2>Nuestras clases </h2>
         <br>
         <p>
            En Mun Yoga Studio, ofrecemos una variedad de clases diseñadas para adaptarse a todos los niveles de experiencia, desde principiantes hasta practicantes avanzados. Cada clase está cuidadosamente estructurada para ayudarte a encontrar equilibrio y bienestar en cuerpo, mente y espíritu.
         </p>
    </div>
    <div class="home_stylesColumn">
        <%= image_tag("gradient_moon.png") %>
    </div>
</div>

<div class="container anasana_cover">
    <%= image_tag("anasana.jpg") %>
</div>

<div class="containerPrices">
    <div class="container">
        <h2>Planes y precios </h2>
        <br>
        <p>No necesitas hacer reservación previa para nuestras clases. Solo llega con tiempo, elige tu espacio y disfruta de tu práctica. Recuerda que tu plan tiene una vigencia de 30 días a partir de la fecha de pago.</p>
        <br>
        <%= link_to "Comprar clases", payments_new_path, class: 'button-orange button-orange-width' %>
    </div>

    <div class="container containerPrices-grid">
        <div class="containerPrices-item">
            <h2>1 Clase</h2>
            <br>
            <p>$250</p>
        </div>
        <div class="containerPrices-item">
            <h2>4 Clases</h2>
            <br>
            <p>$1,100</p>

        </div>
        <div class="containerPrices-item">
            <h2>8 Clases</h2>
            <br>
            <p>$1,500</p>

        </div>
        <div class="containerPrices-item">
            <h2>12 Clases</h2>
            <br>
            <p>$1,950</p>

        </div>
    </div>
    <%= image_tag("lotus.svg") %>
</div>

<div class="container containerLocation">
    <div class="containerLocation-map">
        <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d527.5190177242398!2d-100.25512774462042!3d25.582484537762166!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8662c7c7c0e50f29%3A0x6d0e70e9dfd561ba!2sMun%20Yoga%20Studio!5e0!3m2!1sen!2sus!4v1726679224542!5m2!1sen!2sus" width="600" height="450" style="border:0;border-radius:30px;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
    </div>
    <div class="containerLocation-about">
        <h2>
            Visita<br>
            Mun Yoga Studio
        </h2>
        <br>
        <p>Plaza Nacional #5500, Local 37<br>La Estanzuela, 64988 Monterrey, N.L., Mexico</p>
        <br>
        <p>Whatsapp: +52 1 81 2004 1759</p>
        <br>
        <p>
            Horarios: <br>
            Lunes a Viernes 6 am - 10:30 am, 6 pm - 8: 50 pm<br>
            Sábado<br>
            10 am- 11:30 
        </p>
        <a href="https://www.instagram.com/munyogastudio/" target="_blank">@munyogastudio</a>
    </div>
</div>